# iDO Backend 默认配置文件

# 监控配置
[monitoring]
capture_interval = 1  # 秒
window_size = 60        # 秒
processing_interval = 30 # 秒

# 服务器配置
[server]
host = "0.0.0.0"
port = 8000
debug = false

# 日志配置
[logging]
level = "INFO"
logs_dir = "./logs"
max_file_size = "10MB"
backup_count = 5

# 图像处理配置
[image]
compression_quality = 85
max_width = 1920
max_height = 1080
enable_phash = true

# ============ 图像优化配置 - LLM Token 节省 ============
#
# 图像优化系统通过三层策略减少 LLM API 成本：
# 1. 智能采样 - 基于感知哈希过滤重复/相似图像
# 2. 内容分析 - 跳过静态/空白屏幕
# 3. 动态压缩 - 智能调整图像质量和分辨率
#
# 预期节省效果（基于默认配置）：
# - 图像数量减少 60-75%（通过采样和内容分析）
# - 单张图像大小减少 70-85%（通过动态压缩）
# - 总 Token 消耗减少约 85-95%
#
[image_optimization]

# ========== 基础开关 ==========
# 是否启用图像优化（总开关）
enabled = true

# 优化策略：
# - "none": 不优化，所有图像原样发送
# - "sampling": 仅智能采样（基于感知哈希）
# - "content_aware": 仅内容感知筛选
# - "hybrid": 混合优化（推荐，结合采样和内容分析）
strategy = "hybrid"

# ========== 智能采样配置 ==========
# 感知哈希变化检测阈值 (0.0-1.0)
# 说明：比较当前图像与上一张的相似度，超过阈值才保留
# - 0.05-0.10: 超激进（节省 80-90%，可能丢失细节）
# - 0.10-0.15: 激进（节省 60-75%，适合大部分场景）⭐ 推荐
# - 0.15-0.20: 平衡（节省 40-60%，保留更多细节）
# - 0.20-0.30: 保守（节省 20-40%，最大程度保留信息）
phash_threshold = 0.15

# 最小采样间隔 (秒)
# 说明：即使图像有变化，也必须间隔此时间才采样
# - 1.0-2.0: 高频采样（适合快速变化的界面操作）
# - 2.0-3.0: 中频采样（推荐，平衡细节和成本）⭐ 推荐
# - 3.0-5.0: 低频采样（适合缓慢操作或阅读场景）
min_sampling_interval = 2.0

# 每个事件序列最多采样图像数
# 说明：单次总结最多包含的图像数量（硬限制）
# - 3-5: 极简模式（大幅节省成本，适合简单任务）
# - 6-8: 标准模式（推荐，平衡信息和成本）⭐ 推荐
# - 10-15: 丰富模式（更多上下文，适合复杂任务）
max_images_per_event = 8

# ========== 内容分析配置 ==========
# 是否启用内容分析
# 说明：检测图像对比度、边缘活动、运动等特征
# 启用后可额外跳过 10-20% 的静态/空白内容
enable_content_analysis = true

# 是否启用文本检测（实验性功能）
# 说明：使用 OCR 检测图像中的文本变化
# 注意：需要安装 pytesseract 和 tesseract-ocr
# 会显著增加处理时间（每张图 +0.5-2秒）
enable_text_detection = false

# ========== 动态图像压缩配置 ==========
# 压缩级别（影响质量和分辨率）
# - ultra: 最大压缩
#   质量 30-50, 分辨率 400x300-600x400
#   Token/张: ~50-80, 适合：纯文本界面、快速预览
#
# - aggressive: 激进压缩 ⭐ 推荐
#   质量 40-60, 分辨率 480x360-800x600
#   Token/张: ~80-120, 适合：大部分场景、通用办公
#
# - balanced: 平衡压缩
#   质量 55-75, 分辨率 800x450-1280x720
#   Token/张: ~150-200, 适合：设计工作、UI 详情
#
# - quality: 质量优先
#   质量 75-85, 分辨率 1280x720-1920x1080
#   Token/张: ~250-350, 适合：高精度任务、调试
compression_level = "aggressive"

# 是否启用智能区域裁剪
# 说明：检测图像中的变化区域，只保留有变化的部分
# 效果：可额外减少 30-60% 的图像大小
# 注意：会增加 CPU 开销（每张图 +50-200ms）
# 推荐：仅在图像变化集中在局部区域时启用（如编辑器）
enable_region_cropping = false

# 区域裁剪差异阈值 (0-255)
# 说明：像素亮度差异超过此值才认为是变化区域
# - 10-20: 敏感（保留更多区域）
# - 20-40: 平衡（推荐）⭐
# - 40-60: 严格（只保留明显变化）
crop_threshold = 30

# ========== 性能参数 ==========
# 内存缓存大小（张）
# 说明：在内存中缓存最近的图像 base64 数据
# 推荐：200-500（内存占用约 100-250MB）
memory_cache_size = 500

# ========== 优化效果预估 ==========
# 基于默认配置（aggressive + hybrid），以 20 张原始截图为例：
#
# 1. 智能采样（phash_threshold=0.15, min_interval=2.0）
#    20 张 → 6-8 张（减少 60-70%）
#
# 2. 内容分析（跳过静态屏幕）
#    6-8 张 → 5-6 张（额外减少 10-20%）
#
# 3. 动态压缩（aggressive, 800x600, 质量 50）
#    每张约 250KB → 40KB（减少 84%）
#    每张约 350 tokens → 100 tokens（减少 71%）
#
# 总体效果：
# - 图像数量：20 → 5-6 张（减少 70-75%）
# - Token 消耗：7000 → 500-600（减少 91-93%）
# - 单次总结成本（GPT-4V）：约 $0.070 → $0.006（减少 91%）

# ============ 新架构配置 ============

# 处理配置
[processing]
# 感知层配置
screenshot_interval = 1  # 截屏间隔（秒）
enable_screenshot_deduplication = true  # 启用截图去重

# 事件提取配置
event_extraction_threshold = 20  # 积累多少张截图后触发event提取
min_screenshots_per_event = 2  # 最小截图数量要求

# 活动总结配置
activity_summary_interval = 600  # activity总结间隔（秒，10分钟）
enable_auto_activity_summary = true  # 启用自动活动总结

# 知识和待办合并配置
knowledge_merge_interval = 1200  # knowledge合并间隔（秒，20分钟）
todo_merge_interval = 1200  # todo合并间隔（秒，20分钟）
enable_auto_merge = true  # 启用自动合并

# UI配置
[ui]
recent_events_count = 5  # 最近事件显示数量（可在前端修改）

# 语言配置
[language]
# 系统语言配置，影响prompt选择
default_language = "zh"  # zh | en

# 数据库配置
[database]
# 数据库文件路径（相对于数据目录或绝对路径）
# 留空则使用默认路径：~/.config/ido/ido.db
path = ""
